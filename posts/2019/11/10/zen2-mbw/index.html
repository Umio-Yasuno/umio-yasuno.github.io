<!DOCTYPE html>
<html>
	<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width"><title>Coelacanth&#39;s Dream</title>
<title itemprop="name">Zen2のメモリ帯域 | Coelacanth&#39;s Dream</title>
	<meta property="og:title" content="Zen2のメモリ帯域 | Coelacanth&#39;s Dream" />
	<meta name="twitter:title" content="Zen2のメモリ帯域 | Coelacanth&#39;s Dream" />
	<meta itemprop="name" content="Zen2のメモリ帯域 | Coelacanth&#39;s Dream" />
	<meta name="application-name" content="Zen2のメモリ帯域 | Coelacanth&#39;s Dream" />
	<meta property="og:site_name" content="" />
	
	<meta name="description" content="" />
	<meta itemprop="description" content="" />
	<meta property="og:description" content="" />
	<meta name="twitter:description" content="" />

	<base href="https://umio-yasuno.github.io/posts/2019/11/10/zen2-mbw/">
	<link rel="canonical" href="https://umio-yasuno.github.io/posts/2019/11/10/zen2-mbw/" itemprop="url" /> 
	<meta name="url" content="https://umio-yasuno.github.io/posts/2019/11/10/zen2-mbw/" />
	<meta name="twitter:url" content="https://umio-yasuno.github.io/posts/2019/11/10/zen2-mbw/" /> 
	<meta property="og:url" content="https://umio-yasuno.github.io/posts/2019/11/10/zen2-mbw/" />

	<meta name="author" content="Umio Yasuo" />

	<meta name="keywords" content=" Ryzen, Zen2" />

	<meta name="robots" content="index,follow" />
	<meta name="googlebot" content="index,follow" />

	

	<link rel="preload" href="https://umio-yasuno.github.io/css/lain.min.css" as="style" importance="high">
	<link rel="preload" href="https://umio-yasuno.github.io/css/animation.min.css" as="style" importance="high">

	<link rel="stylesheet" href="https://umio-yasuno.github.io/css/lain.min.css">
	<link rel="stylesheet" href="https://umio-yasuno.github.io/css/animation.min.css">
	</head>
    <body>
		<span class="lace"></span>
<h1><span class="title"><a href="https://umio-yasuno.github.io/">Coelacanth&#39;s Dream</a><span class="blink">_</span></span></h1>
<article class="text">

		<h2><span class="page-title">Zen2のメモリ帯域 </span></h2>
			

<p>今更な気もするけどZen2のメモリ帯域についてのまとめ。</p>

<h3 id="ryzen-matisse">Ryzen Matisse</h3>

<p>まず、Zen/+ではCCXとデータファブリックを32B/Cycleで、<br />
メモリコントローラーとデータファブリックも32B/Cで接続していたが、<br />
<img src="https://umio-yasuno.github.io/image/2019/11/10/pinnacle-diagram.webp" alt="zen-diagram" />
<a href="https://gpuopen.com/gdc-presentations/2019/gdc-2019-s2-amd-ryzen-processor-software-optimization.pdf" target="_blank">AMD Ryzen Processor Software Optimisation</a></p>

<p>Zen2ではCPUダイ（CCD）とI/Oダイ（cIOD）の２つに分離、<br />
そしてCCD（2CCX）とデータファブリック（cIOD）をRead 32B/C、Write 16B/Cで、<br />
メモリコントローラーとデータファブリックを32B/Cで接続している。<br />
<a href="https://news.mynavi.jp/photo/article/20190819-879251/images/photo03l.jpg" target="_blank">AMD 第2世代EPYCプロセッサの実態を紐解く - 構造・性能・普及状況【Deep Dive】 - マイナビニュース</a><br />
このことにより、第三世代Ryzenでは1CCDの製品（例: 3600、3800X等）だとメモリ帯域ベンチマークにおいてWriteが約半分になっていた。</p>

<p><a href="https://www.tweaktown.com/reviews/9051/amd-ryzen-3900x-3700x-zen2-review/index3.html" target="_blank">AMD Ryzen 3900X and 3700X (Zen2) Review (Page 3) - TweakTown</a><br />
TweakTownがAMDに質問した所、省電力目的でそうしたとのこと。<br />
ほとんどのベンチマークにおいて3700Xが2700Xに勝っているため、AMDのアプローチは間違ってはいないだろう。<br />
一般用途でそこまでメモリ帯域に支配される処理があるとも思いにくい。</p>

<p>第三世代Ryzen発売当時、資料では32B/Cとしか書かれておらず、また、AMDの回答を載せたのもTweakTownだけだった（たぶん）ことから、<br />
一部でAIDA64やUEFI等のソフトウェアによる不具合で半分になってるんじゃないかとか言われていた。<br />
<br></p>

<h3 id="epyc-rome">EPYC Rome</h3>

<p>メモリ帯域に制限がかかるのは第二世代EPYC、Romeの一部製品でも見られる。</p>

<blockquote>
<p>Performance optimized to 4 channels with 2667 MHz speed DIMMs for the following models: AMD EPYC™ 7282, AMD EPYC™ 7272, AMD EPYC™ 7252, and AMD EPYC™ 7232P processors.</p>
</blockquote>

<p>とあるように、これら以外の製品の Per Socket Mem BW が 204.80 GB/s（8ch 3200MHz）なのに対し、<br />
これらは 85.30 GB/s（4ch 2667MHz相当）と記載されており、<br />
上記のことから4CCDの構成を取っていると考えられそうだが、<br />
ServerTheHomeのレビュー記事内のlstopo出力結果画像と、<br />
<a href="https://www.servethehome.com/amd-epyc-7232p-review-hard-to-buy-but-solid-part/" target="_blank">AMD EPYC 7232P Review Hard to Buy but Solid Part - ServerTheHome</a><br />
<a href="https://www.servethehome.com/amd-epyc-7232p-review-hard-to-buy-but-solid-part/amd-epyc-7232p-in-gb-nvme-server-topology/" target="_blank">AMD EPYC 7232P In GB NVMe Server Topology - ServerTheHome</a><br />
これらのL3キャッシュサイズが64MBまでのことから、<br />
2CCDの構成にし、メモリ帯域をReadで計算しているのだろう。</p>

<p>ちなみにL3キャッシュサイズが128/192MBの製品は、4/6CCDの構成となっているはずだ。<br />
メモリ帯域はReadによるものなので、最低4CCDあれば8ch分は満たせる。<br />
96MB 3CCDの構成がないのは、sIOD内のデータファブリックが2つあり、それぞれのCCD数は同数（=対称）でないといけない、といった制限があるのだろうか。</p>

<h3 id="threadripper-castlepeak">Threadripper CastlePeak</h3>

<p>第三世代Threadripperは今の所4CCD構成のみなため、Write帯域にも制限は掛からない。<br />
4CCDでも16Cは可能なはずだが、モデルナンバー的に出すつもりはないのだろうか。</p>

<h3 id="おまけ">おまけ</h3>

<p>公式では直ったと思ってたら、GIGABYTEの<a href="https://www.gigabyte.com/Motherboard/TRX40-AORUS-MASTER-rev-10/support#support-cpu" target="_blank">CPU Support</a>では間違ったままだった。<br />
<img src="https://umio-yasuno.github.io/image/2019/11/11/spec-wrong-gigabyte.webp" alt="spec-wrong-gigabyte" /></p>

<footer>
	<hr>
	
		Lastmod: Nov 13, 03:05<br>
	
	
		Author: Umio Yasuo
	
	
	
		<br><a href="https://umio-yasuno.github.io/image/mail.webp" target="_blank">Email</a>
	
	<br><br><br>
</footer>

		</article>
    </body>
</html>
