<!DOCTYPE html>
<html>
	<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width">
	<meta http-equiv="Cache-Control" content="max-age=259200, immutable">
<title>Intel CPUのエラッタJCC、脆弱性TAAが公表される | Coelacanth&#39;s Dream</title>
	<meta name="description" content="個人的にまとめたハードウェア系の情報や推測を公開するブログ的なもの" />
	<base href="https://umio-yasuno.github.io/posts/2019/11/14/intel-jcc-taa/"><meta name="url" content="https://umio-yasuno.github.io/posts/2019/11/14/intel-jcc-taa/" />
	<meta name="author" content="Umio Yasuno" />
	<meta name="keywords" content="Intel, JCC, Errata, TAA, Vulnerability" />
	<meta name="referrer" content="no-referrer" />
	<meta name="format-detection" content="telephone=no, address=no, email=no">
	<meta property="og:locale" content="ja">

		<link rel="preload" href="https://umio-yasuno.github.io/css/footer.min.css" as="style">
		<link rel="preload" href="https://umio-yasuno.github.io/css/page.min.css" as="style">
		<link rel="preload" href="https://umio-yasuno.github.io/css/anim.min.css" as="style"><style>
html {
	background-size: 100%; background-attachment: fixed; background-image: radial-gradient(darkslategray 84%, #00080B 101%);
	z-index: -100
}
.title {	
	font: normal 1.7em monospace;	text-decoration: none;	text-align: end;
	display: block;	margin: .5em 7vw .5em 0;
	}
.title > a {
	color: #6D9CA9;
	text-shadow: 0 2px .8em #538290
}
.page-title, .page-title a {
	color: #FF9900; font-size: 1em;
	margin: 0
}
a {
	color: #66ccff; text-decoration: none;
	margin: 0 .5em 0 .5em
}
.text {
	color: snow;
	box-sizing: border-box;
	padding: 0 2vw 0 2vw;
	z-index: 100;
	line-height: 1.6em;
	word-wrap: break-word;
	text-justify: inter-character;
scrollbar-width: thin; scrollbar-color: rgba(0,128,128, .5) rgba(255,0,0, 0)
}
.text::-webkit-scrollbar {width: 4px; background-color: rgba(255,0,0, 0)}
footer {display: none}h1, h2, h3, h4 {color: #FF9900;font: normal 1em sans-serif}
h1 {font-size: 1.4rem; padding: 0 0 .5rem 0}
h2 {font-size: 1.3rem; padding: 2rem 0 0 0}
h3 {font-size: 1.2rem; padding: 2rem 0 0 .6rem}
h4 {font-size: 1.1rem; padding: 2rem 0 0 1rem}
h1 ~ p {padding-left: 2vw}</style>

			<link rel="stylesheet" href="https://umio-yasuno.github.io/css/page.min.css">
			
			<link rel="preload" href="https://umio-yasuno.github.io/css/ins.min.css" as="style">
		<link rel="icon" href="https://umio-yasuno.github.io/favicon.ico">
	</head>
    <body>
	<main>
		<header>
		<br><div class="title"><a href="https://umio-yasuno.github.io/">Coelacanth&#39;s Dream</a></div>
<br>
		</header>
			<article class="text">
		<h1><span class="page-title">Intel CPUのエラッタJCC、脆弱性TAAが公表される </span></h1>
			

<p>2019-11-12、Intel CPUのエラッタJCC、脆弱性Zombieload亜種のTAAが公表された。<br />
Intelは既に対策を施したマイクロコードを配布しており、Linux Kernel、Windowsも対応を進めている。</p>

<h3 id="jcc-jump-conditional-code">JCC (Jump Conditional Code)</h3>

<p><a href="https://www.phoronix.com/scan.php?page=article&amp;item=intel-jcc-microcode&amp;num=1" rel="nofollow noreferrer" target="_blank">Benchmarks Of JCC Erratum: A New Intel CPU Bug With Performance Implications On Skylake Through Cascade Lake - Phoronix</a><br />
命令を格納するICache（Decoded Streaming Buffer、またはDSBとも呼ばれる）周りにエラッタがあり、<br />
Jump命令がキャッシュライン32Byteの境界を越えるとエラーが引き起こされるとのこと。<br />
マイクロコードの更新で、Jump命令が32Byteの境界を越える、または境界で終わる際、ICacheに格納されるのを防がられるようになる。<br />
ただこれはICacheミスの増加、レガシーデコードパイプラインへの切り替えにより性能低下を引き起こしてしまう。<br />
Intelは0〜4%だと言うが、上のPhoronixによるベンチマークでは明らかに4%では済まない結果が見られる。<br />
またIntelは更新したツールチェインで再コンパイルすることで、性能低下をある程度抑えられると言っているが、<br />
確かにマイクロコード更新前の性能に回復しているものもあれば、更新後と変わらなかったりかえって低下していたりと一概には言えない様子だ。<br />
Spectre/Meltdown/L1TF/MDSは、ユーザーとカーネルスペースを切り替えるワークロードにおいて性能低下の影響があったが、<br />
JCCは広範囲のワークロードに影響がある。</p>

<p>影響を受けるCPUはSkylake世代からCascade Lake世代まで。</p>

<ul>
<li>Skylake</li>
<li>Kabylake</li>
<li>Coffee Lake</li>
<li>Whiskey Lake</li>
<li>Amber Lake</li>
<li>Cascade Lake</li>
</ul>

<p>(追記)
<a href="https://metadata.ftp-master.debian.org/changelogs//non-free/i/intel-microcode/intel-microcode_3.20191112.1_changelog" rel="nofollow noreferrer" target="_blank">intel-microcode (3.20191112.1)  Changelog - Debian</a><br />
DebianでのChangelogでは通常0〜3%、最悪10%と書かれていた。<br />
(追記終了)</p>

<h3 id="taa-tsx-asynchronous-abort-br-cve-2019-11135">TAA (TSX Asynchronous Abort) <br> CVE-2019-11135</h3>

<p><a href="https://www.phoronix.com/scan.php?page=news_item&amp;px=iITLB-Multihit-TAA-Kernel-Code" rel="nofollow noreferrer" target="_blank">Linux Kernel Gets Mitigations For TSX Async Abort Plus Another New Issue: iITLB Multihit - Phoronix</a></p>

<p>詳細な解説は無理なので諦める。</p>

<p><a href="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/Documentation/admin-guide/hw-vuln/tsx_async_abort.rst?id=a7a248c593e4fd7a67c50b5f5318fe42a0db335e" rel="nofollow noreferrer" target="_blank">TAA - TSX Asynchronous Abort - Kernel.org</a><br />
<a href="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/Documentation/x86/tsx_async_abort.rst?id=a7a248c593e4fd7a67c50b5f5318fe42a0db335e" rel="nofollow noreferrer" target="_blank">TSX Async Abort (TAA) mitigation - Kernel.org</a></p>

<p>TSXのトランザクション処理のためのバッファが読み取れてしまう、ということなのだろうか？<br />
マイクロアーキテクチャによるもので、同じ公開範囲ということでMDS、Zombieloadの亜種とされているらしい。<br />
バッファはハイパースレッド間で共有される可能性があるということで、HTT（ハイパースレッティング）を無効化することで、ある程度緩和できる。<br />
対策としては、TSXを無効化することが望ましいとのこと。<br />
Linux Kernelでは対策として、デフォルトで<a href="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/Documentation/admin-guide/hw-vuln/tsx_async_abort.rst?id=a7a248c593e4fd7a67c50b5f5318fe42a0db335e#n274" rel="nofollow noreferrer" target="_blank">TSXを無効化&amp;MDS対策を有効</a>することとなった。<br />
RHELでは<a href="https://access.redhat.com/solutions/tsx-asynchronousabort" rel="nofollow noreferrer" target="_blank">TSXは有効&amp;MDS対策を有効</a>にするとのこと。<br />
Windowsでは直近のセキュリティアップデートで対策したとのことだが、TSXの有効/無効がどうなっているかは不明。<br />
<a href="https://portal.msrc.microsoft.com/en-us/security-guidance/releasenotedetail/164aa83e-499c-e911-a994-000d3a33c573" rel="nofollow noreferrer" target="_blank">November 2019 Security Updates </a></p>

<p>TSXと言えばHaswell世代から導入された新機能であり、メモリーロック処理とトランザクション機能をハードウェアで高速におこなうことで、<br />
最大6倍もの処理能力が謳われていたが、<br />
Haswell初期においてエラッタがあり、無効化され普及にブレーキがかかった。<br />
その後もあるモデルでは有効にされたり、無効にされたりとしていたが、（例: <a href="https://ark.intel.com/content/www/us/en/ark/products/190883/intel-core-i5-9400f-processor-9m-cache-up-to-4-10-ghz.html" rel="nofollow noreferrer" target="_blank">i5-9400F</a> i5-9400では有効になっている）<br />
今回の件ではブレーキどころか後退することとなるかもしれない。</p>

<link rel="stylesheet" href="https://umio-yasuno.github.io/css/footer.min.css">
		</article>
<hr>
<footer>
		<nav class="foot-tags">
			<a href="https://umio-yasuno.github.io/tags">Tags</a>&nbsp;:
			&nbsp;<a href="https://umio-yasuno.github.io/tags/errata">Errata</a>,
			&nbsp;<a href="https://umio-yasuno.github.io/tags/vulnerability">Vulnerability</a>,
		</nav>
		<nav class="foot-categories">
			<a href="https://umio-yasuno.github.io/categories">Categories</a>&nbsp;:
			&nbsp;<a href="https://umio-yasuno.github.io/categories/hardware"> Hardware</a>,
			&nbsp;<a href="https://umio-yasuno.github.io/categories/intel"> Intel</a>,
			&nbsp;<a href="https://umio-yasuno.github.io/categories/cpu"> CPU</a>,
			&nbsp;<a href="https://umio-yasuno.github.io/categories/security"> Security</a>,
		</nav>
	&nbsp;&nbsp;<span>Author : Umio Yasuno</span>&nbsp;&nbsp;/  <span>Lastmod : 2019-11-28 05:55:03 </span> 
		<div><a href="https://umio-yasuno.github.io/about/">About</a></div>
</footer>
<div class="title"><a href="https://umio-yasuno.github.io/">Coelacanth&#39;s Dream</a></div>

	</main>
		<link rel="stylesheet" href="https://umio-yasuno.github.io/css/anim.min.css">
		<div class="lace"></div> 
    </body>
</html>
