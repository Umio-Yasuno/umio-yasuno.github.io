<!DOCTYPE html>
<html>
	<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width">
	<meta http-equiv="Cache-Control" content="max-age=2592000">
<title>RadeonSIでOpenGL 4.6がサポート | Coelacanth&#39;s Dream</title>
	<meta name="description" content="個人的にまとめたハードウェア系の情報や推測を公開するブログ的なもの" />
	<base href="https://umio-yasuno.github.io/posts/2019/11/29/radeonsi-enable-gl4_6/"><meta name="url" content="https://umio-yasuno.github.io/posts/2019/11/29/radeonsi-enable-gl4_6/" />
	<meta name="author" content="Umio Yasuno" />
	<meta name="keywords" content=" Mesa, RadeonSI, OpenGL" />
	<meta name="referrer" content="no-referrer" />
	<meta name="format-detection" content="telephone=no, address=no, email=no">
	<meta property="og:locale" content="ja">

	<link rel="preload" href="https://umio-yasuno.github.io/css/page.min.css" as="style">
	<link rel="preload" href="https://umio-yasuno.github.io/css/anim.min.css" as="style"><style>html {
	background-size: 100%; background-attachment: fixed; background-image: radial-gradient(darkslategray 90%, black 102%);
	z-index: -100}
.title {	
	font: normal 1.5em monospace;
	margin: 0 2vw 0 0;
	display: block;
	text-decoration: none; text-align: end;
 }
.page-title, .page-title a {color: #FF9900; font-size: 1em; margin: 0}
a {color: #66ccff; text-decoration: none; margin: 0 .5em 0 .5em}
.text {
	color: snow;
	box-sizing: border-box;
	padding: 0 2vw 0 2vw; margin: 0 auto 0 auto;
	z-index: 100;

	line-height: 1.7em;
	word-wrap: break-word;
	text-justify: inter-character;
::-webkit-scrollbar {width: 4px; background-color: rgba(255,0,0, 0.0)}
scrollbar-width: thin; scrollbar-color: rgba(0,128,128, 0.5) rgba(255,0,0, 0.0)}footer {
	display: none;	
}
</style>

			<link rel="stylesheet" href="https://umio-yasuno.github.io/css/page.min.css">
		<link rel="icon" href="https://umio-yasuno.github.io/favicon.ico">
	</head>
    <body>
	<main>
		<header>
		<br><div class="title"><a href="https://umio-yasuno.github.io/" style="color:black">Coelacanth&#39;s Dream</a></div>
<br>
		</header>
			<article class="text">
		<h2><span class="page-title">RadeonSIでOpenGL 4.6がサポート </span></h2>
			

<p>オープンソースなRadeon OpenGLドライバ、RadeonSIにてOpenGL 4.6が有効「可能」となった。<br />
<a href="https://gitlab.freedesktop.org/mesa/mesa/commit/754c7b893959d97483e6b5fccefbdbaa641c70ca" rel="nofollow noreferrer" target="_blank">radeonsi: enable SPIR-V and GL 4.6 for NIR</a><br />
しかしデフォルトでは有効にならず、ひと手間設定を変える必要がある。</p>

<h3 id="有効方法">有効方法</h3>

<p>まだ正式にはリリースされていないため、Debian/Ubuntuユーザーは以下のようなPPA（Personal Package Archives）を追加、そして最新版をインストール、<br />
<a href="https://launchpad.net/~oibaf/+archive/ubuntu/graphics-drivers" rel="nofollow noreferrer" target="_blank">https://launchpad.net/~oibaf/+archive/ubuntu/graphics-drivers</a><br />
もしくは<a href="https://gitlab.freedesktop.org/mesa/mesa" rel="nofollow noreferrer" target="_blank">Mesaのmasterブランチ</a>からクローン、そして自前でビルドをする必要がある。</p>

<p>上記PPAはほんと最新版を追い続けるため、アップデートがしつこい。使用していた頃、ほぼ毎日来ていたと記憶している。<br />
リリース候補版でもないため、不具合が起きやすい。それなのに、Debian/Ubuntuの正式パッケージを（たぶん）上書きするため、<br />
致命的な不具合があった場合、復旧がちと面倒だ。<br />
そのため、自前でビルドすることをオススメしたい。<br />
ただ、ビルドの準備をするのも結構な手間がかかる。<br />
libdrm_amdgpuのバージョンが2.4.99以上を要求されるため、ディストリビューションによってはまずそちらの最新版をビルドする必要があったり、<br />
<a href="https://gitlab.freedesktop.org/mesa/mesa/commit/677bb80c98276514d3df497d3c88908158794637" rel="nofollow noreferrer" target="_blank">meson: require libdrm_amdgpu 2.4.99 for Navi</a><br />
<a href="https://lists.x.org/archives/xorg-announce/2019-October/003028.html" rel="nofollow noreferrer" target="_blank">[ANNOUNCE] libdrm 2.4.100</a><br />
RadeonSI、RADVにてLLVM 7のサポートがなくなったため、これもディストリによってはLLVM 8/9をインストールする必要がある。
<a href="https://gitlab.freedesktop.org/mesa/mesa/commit/1fd60db4a1fca96ccf9293d0c03158baf7d215a5" rel="nofollow noreferrer" target="_blank">ac,radv,radeonsi: remove LLVM 7 support</a></p>

<p>軽く調べたところ、</p>

<table>
<thead>
<tr>
<th align="left">Distribution</th>
<th align="center">LLVM</th>
<th align="center">libdrm_amdgpu</th>
</tr>
</thead>

<tbody>
<tr>
<td align="left">Debian buster (stable)</td>
<td align="center">7</td>
<td align="center">2.497</td>
</tr>

<tr>
<td align="left">Debian bullseye (testing)</td>
<td align="center">8</td>
<td align="center">2.4.100</td>
</tr>

<tr>
<td align="left">Ubuntu bionic (18.04LTS)</td>
<td align="center">6</td>
<td align="center">2.492</td>
</tr>

<tr>
<td align="left">Ubuntu disco (19.04)</td>
<td align="center">8</td>
<td align="center">2.497</td>
</tr>
</tbody>
</table>

<p>となっていた。<br />
Debian bullseye (testing)以外では別途インストールする必要がある。<br />
Debian/UbuntuでのLLVM 8/9のインストールは下記URLに従えばいいだけなため、特別難しくはない。<br />
<a href="https://apt.llvm.org/" rel="nofollow noreferrer" target="_blank">LLVM Debian/Ubuntu nightly packages</a></p>

<p>Mesaの詳細なビルド方法は長くなるだろうから、私が参考にしたURLを載せておく。<br />
<a href="https://dri.freedesktop.org/wiki/Building/" rel="nofollow noreferrer" target="_blank">https://dri.freedesktop.org/wiki/Building/</a></p>

<p>前置きが少し長くなってしまった。<br />
そしてNIRの有効方法だが、一番楽なのは .drirc を編集することだ。<br />
driconf、 <a href="https://github.com/jlHertel/adriconf" rel="nofollow noreferrer" target="_blank">adriconf</a> を使うか、<br />
直接 ~/.drirc を編集して、 Default の項目内に</p>

<pre><code>&lt;option name=&quot;radeonsi_enable_nir&quot; value=&quot;true&quot; /&gt;
</code></pre>

<p>を追加すればいい。<br />
試したいだけなら、OpenGLを呼び出すコマンド（glxinfo -B等）の前に</p>

<pre><code>radeonsi_enable_nir=true
</code></pre>

<p>を入力してもいい。</p>

<h3 id="opengl-4-6">OpenGL 4.6</h3>

<p>OpenGL 4.6がリリースされたのは2017年のSIGGRAPH会期中であり、だいぶ前である。<br />
<a href="https://www.4gamer.net/games/107/G010729/20170907023/" rel="nofollow noreferrer" target="_blank">OpenGL 4.6の進化点やOpenCLの将来について，Khronos Group代表のNeil Trevett氏に聞いてみた - 4gamer.net</a><br />
だが、Windows環境やプロプライエタリなドライバでは検証、登録される中、Linux&amp;オープンソースドライバでは来るか来るかと言われながら、<br />
つい最近になってようやくIntel、AMD共に公式にサポートされた。<br />
<a href="https://www.khronos.org/conformance/adopters/conformant-products/opengl" rel="nofollow noreferrer" target="_blank">https://www.khronos.org/conformance/adopters/conformant-products/opengl</a></p>

<p><a href="https://lists.freedesktop.org/archives/mesa-dev/2019-November/223795.html" rel="nofollow noreferrer" target="_blank">[Mesa-dev] iris now officially OpenGL 4.6 conformant</a><br />
<a href="https://lists.freedesktop.org/archives/mesa-dev/2019-November/223821.html" rel="nofollow noreferrer" target="_blank">[Mesa-dev] [radeonsi] enable OpenGL 4.6</a></p>

<p>OpenGL 4.6になってユーザーが何か得するのかと言うと、一応はすると思う。<br />
<a href="https://jp.khronos.org/news/press/spir-v-opengl-4.6-siggraph-2017" rel="nofollow noreferrer" target="_blank">クロノス・グループ、SPIR-V機能を搭載した「OpenGL® 4.6」を発表</a><br />
RadeonSIではNIRを有効にする必要があり、そしてNIRでは少し前の結果ではあるものの、若干の性能向上とCPU使用率の減少が確認されている。<br />
<a href="https://www.phoronix.com/scan.php?page=article&amp;item=radeonsi-nir-2019&amp;num=1" rel="nofollow noreferrer" target="_blank">https://www.phoronix.com/scan.php?page=article&amp;item=radeonsi-nir-2019</a><br />
今回のOpenGL 4.6サポートはこのNIRが安定したということでもあるため、このことによる得も享受できる。<br />
ディスクキャッシュ周りも改良が続けられており、それがおかげが「体感で」快適になったとも感じる。<br />
あくまで体感だから信用はならないが。</p>

<p>あ、あと libzstd-dev のインストールを忘れずに。</p>

<link rel="stylesheet" href="https://umio-yasuno.github.io/css/footer.min.css">
<hr>
<footer>
		<nav class="foot-tags">
			<a href="https://umio-yasuno.github.io/tags">Tags</a>&nbsp;:
			&nbsp;<a href="https://umio-yasuno.github.io/tags/radeon">Radeon,</a>
			&nbsp;<a href="https://umio-yasuno.github.io/tags/radeonsi">RadeonSI,</a>
			&nbsp;<a href="https://umio-yasuno.github.io/tags/mesa">Mesa,</a>
		</nav>
		<nav class="foot-categories">
			<a href="https://umio-yasuno.github.io/categories">Categories</a>&nbsp;:
			&nbsp;<a href="https://umio-yasuno.github.io/categories/software"> Software,</a>
			&nbsp;<a href="https://umio-yasuno.github.io/categories/amd"> AMD,</a>
			&nbsp;<a href="https://umio-yasuno.github.io/categories/gpu"> GPU,</a>
		</nav>
	&nbsp;&nbsp;<span>Author : Umio Yasuno</span>&nbsp;&nbsp;/ <span data-lastmod="Dec 1 2019, 08:09">Lastmod : Dec 1, 08:09</span>
		<address class="mail"><a href="https://umio-yasuno.github.io/about/">About</a></address>
</footer>
<br>
</article>
			<br><div class="title"><a href="https://umio-yasuno.github.io/" style="color:black">Coelacanth&#39;s Dream</a></div>
<br>
	</main>
		<link rel="stylesheet" href="https://umio-yasuno.github.io/css/anim.min.css">
		<div class="lace"></div> 
    </body>
</html>
