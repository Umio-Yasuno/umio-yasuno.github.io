<!DOCTYPE html>
<html lang="ja">
  <head>

<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>AMDGPUドライバーにて RDNA 2 アーキテクチャの GFX Async Ring が有効化 | Coelacanth&#39;s Dream</title>

<link rel="canonical" href="https://www.coelacanth-dream.com/posts/2022/08/11/rdna_2-async-ring/">

<link rel="icon" type="image/png" sizes="128x128" href="https://www.coelacanth-dream.com/icon.png">

<link rel="alternate" type="application/rss+xml" href="https://www.coelacanth-dream.com/posts/index.xml">
<link rel="alternate" type="application/rss+xml" href="https://www.coelacanth-dream.com/lastmod/index.xml">

<meta property="og:site_name" content="Coelacanth&#39;s Dream">
<meta property="og:type" content="article">
<meta property="og:title" content="AMDGPUドライバーにて RDNA 2 アーキテクチャの GFX Async Ring が有効化 | Coelacanth&#39;s Dream">
<meta name="twitter:card" content="summary">
<meta property="og:image" content="https://www.coelacanth-dream.com/icon.png"><meta property="og:locale" content="ja_JP">
<meta name="author" content="Umio Yasuno">
<meta name="copyright" content="&copy; 2019 - 2022 Umio-Yasuno">

    <link rel="preload" href="https://www.coelacanth-dream.com/css/ds.min.css" as="style"><link rel="preload" href="https://www.coelacanth-dream.com/css/page.min.css" as="style">

    <style>
  html{background:#0b4050 fixed no-repeat;font-size:.95rem}body{display:grid;grid-template:var(--body-grid,repeat(4,auto) 2rem/auto .5rem .25rem);gap:1rem 0;scrollbar-width:thin;scrollbar-color:rgba(17,100,125,.9)#0000}.site-title{grid-row:1/2;grid-column:1/-3;margin:.5rem 0 0;font:2rem/1 monospace;word-spacing:100vw;text-align:right;isolation:isolate;text-shadow:.1em .1em .7em #f1f4f3}.site-title-link{color:#b7c8c4;text-decoration:none;padding:0}.site-title-link:hover{color:#dae3e0}.lain-e{display:inline-block;font:700 .65em/1 monospace;margin:0 -.2em 0 -.1em;padding:0 .3em .15em;background-color:#0006;clip-path:circle(.45em);transform:rotate(-24deg)}.text{display:grid;grid-row:var(--text-row,2/3);grid-column:var(--text-column,1/-2);color:#fffefe;line-height:1.6;grid-template:auto/.5% .5% auto 1%;gap:.8rem 0;overflow:hidden;overflow-wrap:anywhere;word-break:break-word}footer{display:var(--f-disp,grid);grid-row:3/4;grid-column:1/-1;contain:content}.side,.slide{position:fixed;contain:content}.side{display:var(--side-disp,none)}.slide{display:grid;visibility:var(--slide-vis,hidden)}a{color:#b7ffff;text-decoration:none;margin:0;padding:0 .2rem}hr{background-color:#17736b;padding:0;border-width:0;width:99%;height:1px}::-webkit-scrollbar{width:.2rem;height:.2rem;background-color:#0000}::-webkit-scrollbar-thumb{background-color:rgba(17,100,125,.9)}::-webkit-scrollbar-corner,::-webkit-scrollbar-resizer{display:none}.crt{background:radial-gradient(#eee1 0%,#0000 76%,#0000 95%,#111 99%)50%/contain fixed no-repeat,linear-gradient(to bottom,#0000 50%,#0002 50%)50%/100% .6rem fixed repeat-y,linear-gradient(to right,#d001 33.4%,#0d01 33.4%,#0d01 66.8%,#00d1 66.8%)50%/.2rem 100% fixed repeat-x;opacity:.6;width:100%;height:100%;position:fixed;inset:0;z-index:2;pointer-events:none;isolation:isolate;contain:strict}.sb{display:inline-block;font:.8rem/1.2 sans-serif;margin:auto 0;padding:.12rem .5rem .24rem;max-width:max-content;text-align:center;cursor:pointer;color:#eff;border:1px solid #0d4e62;border-color:#14728f #072a35 #072a35 #14728f;border-radius:.1rem;text-decoration:none;background-color:var(--sb-bg,#0d4e62);contain:content}.sb:active{--sb-bg:#0b4050}.sb::before{content:attr(data-btn-txt)}.rss::before{content:"RSS: " attr(data-rss-name)}.rss-block{display:flex;gap:.2rem}.share-block{display:flex;flex-flow:row wrap;gap:.2rem .1rem;justify-content:flex-end}@media(min-width:840px){body{--body-grid:repeat(5, auto) 6vh / calc(160px + 1rem) 0.2rem 0.6rem auto 0 0.5rem}.text{--text-row:auto;--text-column:2/-2}.side{--side-disp:block;height:98vh;width:160px;inset:1vh 0 0;padding:0 .5rem;color:#0ad1c1;border-right:1px solid #17736b;font-size:1rem;overflow:scroll}.slide{display:none}footer{--f-disp:none}}
  .page-title{grid-column:2/-2;font:1.1rem sans-serif;color:#e5ebea;margin:0;padding:0}.sect-title{font-size:1rem;margin:0}.delay-ds{visibility:var(--ds,hidden)}.home,.posts,.cat-tag,.tag-comple{grid-column:2/-1}datalist{display:none}
  .page-main{font-size:.95rem;grid-column:2/-1;overflow:hidden;contain:content;display:flex;flex-flow:column nowrap;gap:.6rem 0}.page-main>p{margin:.3rem 0}.page-main>p::before{content:'';padding:0 .25rem}.delay-page{visibility:var(--dp,hidden)}.page-title{color:#ffaa37;font:1.1rem/1.4 sans-serif;grid-column:2/-2;margin:0;overflow-wrap:break-word;word-break:break-word}figure{width:98%;height:54vh}.article-time{grid-column:3/-1;display:flex;text-align:end;margin:0;flex-flow:column nowrap;gap:.1rem 0;color:#0ad1c1;font:.9rem/1.1 monospace}
</style>
    <link rel="preload" href="https://www.coelacanth-dream.com/js/main.min.js" as="script">
    <script type="application/ld+json">{"@context":"https://schema.org/","@type":"Article","dateCreated":"2022-08-11","dateModified":"2022-08-11","datePublished":"2022-08-11","headline":"AMDGPUドライバーにて RDNA 2 アーキテクチャの GFX Async Ring が有効化","image":"https://www.coelacanth-dream.com/icon.png","name":"AMDGPUドライバーにて RDNA 2 アーキテクチャの GFX Async Ring が有効化"}</script>
  </head>
  <body><header class="site-title" title="Coelacanth&#39;s Dream">
  <a href="https://www.coelacanth-dream.com/" class="site-title-link">Co<span class="lain-e">e</span>lacanth's Dream</a>
</header>
<link rel="stylesheet" href="https://www.coelacanth-dream.com/css/page.min.css">

    <main class="text">
      <h1 class="page-title">AMDGPUドライバーにて RDNA 2 アーキテクチャの GFX Async Ring が有効化</h1>

  <article class="page-main delay-page"><aside class="share-block">
<button
    type="button"
    class="share-copy-button sb cp-url-title"
    onclick="copy_url({ url: true, title: true })"
    tabindex="0"
    aria-label="Copy URL button"
    data-btn-txt="Copy URL &amp; Title"
  ></button><a
    href="https://www.coelacanth-dream.com/posts/index.xml"
    class="rss sb"
    target="_blank"
    tabindex="0"
    role="button"
    data-rss-name="Home"
    aria-label="RSS: Home"
  ></a><a
    href="https://www.coelacanth-dream.com/lastmod/index.xml"
    class="rss sb"
    target="_blank"
    tabindex="0"
    role="button"
    data-rss-name="Updated"
    aria-label="RSS: Updated"
  ></a></aside><aside class="article-time">
    <time datetime="2022-08-11 09:07 +0900">Post: 2022/08/11 09:07 &#43;0900</time>
    <aside class="update">Update: 2022/08/11 10:54 &#43;0900</aside>
  </aside><p>Linux Kernel の次回バージョンアップ、5.20/6.0 に向けた AMDGPUドライバーの更新では、<em>RDNA 2/GFX10.3 アーキテクチャ</em> の GFX Async Ring (MicroEngine1, Pipe1) を有効化するパッチが取り込まれる。</p>
<ul>
<li><a href="https://lists.freedesktop.org/archives/amd-gfx/2022-July/081068.html" target="_blank" rel="noopener noreferrer" title="[pull] amdgpu, amdkfd, radeon drm-next-5.20">[pull] amdgpu, amdkfd, radeon drm-next-5.20</a></li>
</ul>
<blockquote>
<pre><code> Arunpravin Paneer Selvam (3):
       drm/amd/amdgpu: Enable high priority gfx queue
       drm/amd/amdgpu: add pipe1 hardware support
       drm/amd/amdgpu: Fix alignment issue
</code></pre>
<div class="quote-source">引用元:<cite class="source-link"><a href="https://lists.freedesktop.org/archives/amd-gfx/2022-July/081068.html" target="_blank" rel="noopener noreferrer" title="[pull] amdgpu, amdkfd, radeon drm-next-5.20">[pull] amdgpu, amdkfd, radeon drm-next-5.20</a></cite>
</div>

</blockquote>
<h2 id="async-ring">GFX Async Ring<a href="#async-ring" class="head-cur-link" aria-hidden></a>
</h2>
<p>GFX Ring/ME は AMD GPU に搭載されているマイクロコントローラの一種であり、GFX エンジンへのグラフィクスキューをコントロールする役割を持つ。<br>
Compute エンジン、コンピュートキュー用のマイクロコントローラは MEC (MicroEngine Compute) とされている。<br>
ME と MEC はハードウェアブロックとしては GFX/Compute パイプラインのフロントエンドに位置する。</p>
<p><em>GFX9/Vega</em> 世代までは GFX Ring/ME は通常 1基の構成となっており、<em>GFX10/RDNA 1</em> 世代からは優先度が高く設定されたグラフィクスキュー向けに GFX Async Ring が追加された。<br>
しかし <em>GFX10/RDNA 1</em> 世代では GFX Async Ring は無効化されており<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>、これはその後に AMDGPUドライバーへのパッチが初めて公開された <em>Sienna Cichlid/Navi21</em>、<em>RDNA 2/GFX10.3</em> 世代においても同様だった。<sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup></p>
<p>そうした状態だったが、<em>RDNA 2/GFX10.3</em> 世代の GFX Async Ring が Linux Kernel 5.20/6.0 では有効化される。<br>
パッチでは <em>RDNA 2/GFX10.3 APU</em> も対象に含まれている。<br>
<em>GFX10/RDNA 1</em> 世代の GFX Async Ring を無効化するパッチは 2020/03/02、<em>Sienna Cichlid/Navi21</em> へのパッチは 2020/06/01 に投稿されたため、約 2年越しの有効化となる。</p>
<ul>
<li><a href="https://gitlab.freedesktop.org/agd5f/linux/-/commit/b07d1d73b09ef40e91ace51a2e167391676a8175" target="_blank" rel="noopener noreferrer" title="drm/amd/amdgpu: Enable high priority gfx queue (b07d1d73) · Commits · Alex Deucher / linux · GitLab">drm/amd/amdgpu: Enable high priority gfx queue (b07d1d73) · Commits · Alex Deucher / linux · GitLab</a></li>
<li><a href="https://gitlab.freedesktop.org/agd5f/linux/-/commit/4c7631800e6bf0eced08dd7b4f793fcd972f597d" target="_blank" rel="noopener noreferrer" title="drm/amd/amdgpu: add pipe1 hardware support (4c763180) · Commits · Alex Deucher / linux · GitLab">drm/amd/amdgpu: add pipe1 hardware support (4c763180) · Commits · Alex Deucher / linux · GitLab</a></li>
</ul>
<blockquote>
<pre><code> Starting from SIENNA CICHLID asic supports two gfx pipes, enabling
 two graphics queues, 1 on each pipe, pipe0 queue0 would be the normal
 piority queue and pipe1 queue0 would be the high priority queue
	
 Only one queue per pipe is visble to SPI, SPI looks at the priority
 value assigned to CP_GFX_HQD_QUEUE_PRIORITY from each of the queue's
 HQD/MQD.
	
 Create contexts applying AMDGPU_CTX_PRIORITY_HIGH which submits job
 to the high priority queue on GFX pipe1. There would be starvation
 of LP workload if HP workload is always available.
</code></pre>
<div class="quote-source">引用元:<cite class="source-link"><a href="https://gitlab.freedesktop.org/agd5f/linux/-/commit/b07d1d73b09ef40e91ace51a2e167391676a8175" target="_blank" rel="noopener noreferrer" title="drm/amd/amdgpu: Enable high priority gfx queue (b07d1d73) · Commits · Alex Deucher / linux · GitLab">drm/amd/amdgpu: Enable high priority gfx queue (b07d1d73) · Commits · Alex Deucher / linux · GitLab</a></cite>
</div>

</blockquote>
<p>User Mode Driver 側では <em>RadeonSI (OpenGL)</em> ドライバーに <code>EGL_IMG_context_priority</code> のサポートを追加し、優先度の高いコンテキストの作成を可能にするパッチ、マージリクエストが公開されているが、これも GFX Async Ring の有効化と関係しているのではないかと思われる。<br>
パッチはすでに main ブランチに取り込まれている。</p>
<ul>
<li><a href="https://gitlab.freedesktop.org/mesa/mesa/-/merge_requests/16594" target="_blank" rel="noopener noreferrer" title="radeonsi: Add support for EGL_IMG_context_priority (!16594) · Merge requests · Mesa / mesa · GitLab">radeonsi: Add support for EGL_IMG_context_priority (!16594) · Merge requests · Mesa / mesa · GitLab</a></li>
</ul>
<p><em>RadeonSI</em> へのパッチを投稿した Vlad Zahorodnii 氏は、高い優先度を設定する主な対象として、Wayland コンポジターのようなレンダリングコマンドをできる限り早くに処理する必要のアプリケーションを挙げている。</p>
<section class="reference"><h3 id="reference_title">参考リンク<a href="#reference_title" class="head-cur-link" aria-hidden></a>
</h3>
<ul>
<li><a href="https://www.kernel.org/doc/html/latest/gpu/amdgpu/driver-core.html#graphics-and-compute-microcontrollers" target="_blank" rel="noopener noreferrer" title="Core Driver Infrastructure — The Linux Kernel documentation">Core Driver Infrastructure — The Linux Kernel documentation</a></li>
</ul>
</section>

<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p><a href="https://lists.freedesktop.org/archives/amd-gfx/2020-March/046692.html" target="_blank" rel="noopener noreferrer" title="[PATCH] drm/amdgpu: disable 3D pipe 1 on Navi1x">[PATCH] drm/amdgpu: disable 3D pipe 1 on Navi1x</a>&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2">
<p><a href="https://lists.freedesktop.org/archives/amd-gfx/2020-June/050126.html" target="_blank" rel="noopener noreferrer" title="[PATCH 162/207] drm/amdgpu: only use one gfx pipe for Sienna_Cichlid">[PATCH 162/207] drm/amdgpu: only use one gfx pipe for Sienna_Cichlid</a>&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>
</article><nav class="article-bottom-tags delay-page"><a href="https://www.coelacanth-dream.com/tags/rdna_2" class="bottom-tag-link"  title="RDNA_2">#RDNA 2</a><a href="https://www.coelacanth-dream.com/tags/linux_kernel" class="bottom-tag-link"  title="Linux_Kernel">#Linux Kernel</a></nav><aside class="article-bottom-misc delay-page"><a
    href="https://www.coelacanth-dream.com/posts/index.xml"
    class="rss sb"
    target="_blank"
    tabindex="0"
    role="button"
    data-rss-name="Home"
    aria-label="RSS: Home"
  ></a><a
    href="https://www.coelacanth-dream.com/lastmod/index.xml"
    class="rss sb"
    target="_blank"
    tabindex="0"
    role="button"
    data-rss-name="Updated"
    aria-label="RSS: Updated"
  ></a><a href="https://www.coelacanth-dream.com/about/#contact" class="sb" target="_blank" rel="noopener noreferrer">Feedback</a>
<a href="https://github.com/Umio-Yasuno/coelacanth-dream/commits/master/content/posts/2022/08/11/rdna_2-async-ring.md" class="changelog sb" target="_blank" rel="noopener noreferrer">Changelog</a>
</aside>
    </main><link rel="stylesheet" href="https://www.coelacanth-dream.com/css/ds.min.css"><footer class="delay-ds"><hr>


  <nav class="foot-about"><a href="https://www.coelacanth-dream.com/about/#about">About</a>
<a href="https://www.coelacanth-dream.com/about/#contact">Contact</a>
<a href="https://www.coelacanth-dream.com/about/#fediverse">Fediverse</a>
<a href="https://www.coelacanth-dream.com/webring">Webring</a>
<a href="#" class="pagetop sb">Page Top</a>
  </nav>

<aside class="site-desc"><aside class="hosted">Hosted by <a href="https://github.com/Umio-Yasuno/umio-yasuno.github.io" target="_blank" rel="noopener noreferrer">Github Pages</a>
</aside><aside class="hosted powered">Powered by <a href="https://github.com/gohugoio/hugo" target="_blank" rel="noopener noreferrer">Hugo 0.101.0</a>
</aside></aside><aside class="copyright">&copy; 2019 - 2022 Umio-Yasuno</aside>
</footer>
<aside class="side">
  <aside class="side-block delay-ds" id="side-menu" role="menu"><nav class="menu-links">
  <a href="https://www.coelacanth-dream.com/">Home</a>
  <a href="https://www.coelacanth-dream.com/posts/">Posts</a>
  <a href="https://www.coelacanth-dream.com/lastmod/">Updated</a>
  <a href="https://www.coelacanth-dream.com/categories/database/">Database</a>
  <a href="https://www.coelacanth-dream.com/gh-search/">Search</a><button
    type="button"
    class="sb"
    onclick="random_page()"
    tabindex=""
  >Random</button>
</nav>
<nav class="menu-cat-tag"><nav class="menu-cat-tag-block"><a href="https://www.coelacanth-dream.com/categories/" class="menu-cat-tag-title">Category</a><a href="https://www.coelacanth-dream.com/categories/amd/" class="menu-cat-tag-lower">AMD</a><a href="https://www.coelacanth-dream.com/categories/gpu/" class="menu-cat-tag-lower">GPU</a><a href="https://www.coelacanth-dream.com/categories/hardware/" class="menu-cat-tag-lower">Hardware</a>
  </nav><nav class="menu-cat-tag-block"><a href="https://www.coelacanth-dream.com/tags/" class="menu-cat-tag-title">Tag</a><a href="https://www.coelacanth-dream.com/tags/linux_kernel/" class="menu-cat-tag-lower">Linux Kernel</a><a href="https://www.coelacanth-dream.com/tags/rdna_2/" class="menu-cat-tag-lower">RDNA 2</a>
  </nav></nav><nav class="rss-block"><a
    href="https://www.coelacanth-dream.com/posts/index.xml"
    class="rss sb"
    target="_blank"
    tabindex="0"
    role="button"
    data-rss-name="Home"
    aria-label="RSS: Home"
  ></a><a
    href="https://www.coelacanth-dream.com/lastmod/index.xml"
    class="rss sb"
    target="_blank"
    tabindex="0"
    role="button"
    data-rss-name="Updated"
    aria-label="RSS: Updated"
  ></a></nav>
    <nav class="menu-about"><a href="https://www.coelacanth-dream.com/about/#about">About</a>
<a href="https://www.coelacanth-dream.com/about/#contact">Contact</a>
<a href="https://www.coelacanth-dream.com/about/#fediverse">Fediverse</a>
<a href="https://www.coelacanth-dream.com/webring">Webring</a>
</nav><aside class="site-desc"><aside class="hosted">Hosted by <a href="https://github.com/Umio-Yasuno/umio-yasuno.github.io" target="_blank" rel="noopener noreferrer">Github Pages</a>
</aside><aside class="hosted powered">Powered by <a href="https://github.com/gohugoio/hugo" target="_blank" rel="noopener noreferrer">Hugo 0.101.0</a>
</aside></aside><aside class="copyright">&copy; 2019 - 2022 Umio-Yasuno</aside>
  </aside>
</aside>
<aside class="slide"><input
    type="checkbox"
    id="menu-open"
    checked
  >
  <label
    class="menu-label"
    for="menu-open"
  ></label>

  <nav class="slide-menu-block"><nav class="menu-links">
  <a href="https://www.coelacanth-dream.com/">Home</a>
  <a href="https://www.coelacanth-dream.com/posts/">Posts</a>
  <a href="https://www.coelacanth-dream.com/lastmod/">Updated</a>
  <a href="https://www.coelacanth-dream.com/categories/database/">Database</a>
  <a href="https://www.coelacanth-dream.com/gh-search/">Search</a><button
    type="button"
    class="sb"
    onclick="random_page()"
    tabindex=""
  >Random</button>
</nav>
<nav class="menu-cat-tag"><nav class="menu-cat-tag-block"><a href="https://www.coelacanth-dream.com/categories/" class="menu-cat-tag-title">Category</a><a href="https://www.coelacanth-dream.com/categories/amd/" class="menu-cat-tag-lower">AMD</a><a href="https://www.coelacanth-dream.com/categories/gpu/" class="menu-cat-tag-lower">GPU</a><a href="https://www.coelacanth-dream.com/categories/hardware/" class="menu-cat-tag-lower">Hardware</a>
  </nav><nav class="menu-cat-tag-block"><a href="https://www.coelacanth-dream.com/tags/" class="menu-cat-tag-title">Tag</a><a href="https://www.coelacanth-dream.com/tags/linux_kernel/" class="menu-cat-tag-lower">Linux Kernel</a><a href="https://www.coelacanth-dream.com/tags/rdna_2/" class="menu-cat-tag-lower">RDNA 2</a>
  </nav></nav><nav class="rss-block"><a
    href="https://www.coelacanth-dream.com/posts/index.xml"
    class="rss sb"
    target="_blank"
    tabindex="0"
    role="button"
    data-rss-name="Home"
    aria-label="RSS: Home"
  ></a><a
    href="https://www.coelacanth-dream.com/lastmod/index.xml"
    class="rss sb"
    target="_blank"
    tabindex="0"
    role="button"
    data-rss-name="Updated"
    aria-label="RSS: Updated"
  ></a></nav>
    <nav class="menu-about"><a href="https://www.coelacanth-dream.com/about/#about">About</a>
<a href="https://www.coelacanth-dream.com/about/#contact">Contact</a>
<a href="https://www.coelacanth-dream.com/about/#fediverse">Fediverse</a>
<a href="https://www.coelacanth-dream.com/webring">Webring</a>

    </nav>
  </nav>
</aside>
<div class="crt"></div>
    <script defer src="https://www.coelacanth-dream.com/js/main.min.js"></script>

    <template id="msg_tmp">
      <div id="toast_msg" class="toast_msg"></div>
    </template>
  </body>
</html>